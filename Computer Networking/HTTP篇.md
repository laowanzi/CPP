## HTTP基本概念

***

### HTTP是什么？

HTTP是超文本传输协议，也就是HyperText Transfer Protocol

超文本：超越了普通文本的文本，超文本中有其他文本的链接

### HTTP常见的状态码有哪些？

| 状态码分类 | 具体含义   | 常见的状态码 |
| ---------- | ---------- | ------------ |
| 1xx        | 提示信息   |              |
| 2xx        | 成功       |              |
| 3xx        | 重定向     |              |
| 4xx        | 客户端错误 |              |
| 5xx        | 服务器错误 |              |

###  HTTP常见字段

* `Host`：表示域名
* `Content-Length`：数据长度（单位：字节）
* `Connection`：是否保持连接
* `Content-Type`：本次数据的格式
* `Content-Encoding`：说明数据的压缩方法
* `Accept-Encoding`：接受的压缩方法

## GET和POST

### 两者的区别

GET的语义是从服务器获取指定的资源

POST的语义是根据请求负荷（报文body）对指定的资源做出处理

在HTTP协议中，安全是指不会破坏服务器上的资源，幂等是指多次执行同样的操作，结果都是相同的

根据RFC规范的语义，GET方式是安全的，幂等的，可被缓存的

POST方式是不安全，不幂等，（大部分）不可缓存的

## HTTP缓存技术

强制缓存：只要浏览器判断缓存没有过期，则直接使用浏览器的本地缓存，主动权在浏览器这边

强缓存使用响应头部`Cache-Control`和`Expires`

`Cache-Control`：是一个相对时间，**优先级更高**，选项更多，设置更加精细，所以推荐使用

`Expires`：是一个绝对时间

协商缓存：未命中强制缓存时才能发起带有协商缓存字段的请求

第一种：请求头部中的 `If-Modified-Since` 字段与响应头部中的 `Last-Modified` 字段实现

第二种：请求头部中的 `If-None-Match` 字段与响应头部中的 `ETag` 字段

 `ETag` 信息优先级比 `Last-Modified` 高

第二次收到请求时，服务端比较ETag

* 值相等，发送304
* 不相等，发送200并且返回最新的资源

## HTTP特性

### 优点

简单、灵活和易于扩展、应用广泛和跨平台

1. 基本的报文格式就是`header + body`，头部信息也是`key-value`的形式

### 缺点

无状态、明文传输、不安全

不安全

* 通信使用明文
* 不验证通信方的身份
* 无法证明报文的完整性

### 性能

* 长连接：减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的开销
* 管道网络传输：实际上没有被使用
* 队头阻塞：请求序列的一个请求被阻塞，后面排队的请求也受影响

## HTTP与HTTPS

### 区别

* HTTPS是加密版本，在TCP和网络层之间加入SSL/TLS安全协议
* HTTPS还需进行SSL/TSL的握手过程
* 端口号不同，HTTP默认端口号是80，HTTPS默认端口号是443
* HTTPS需要向CA申请数字证书

### HTTPS解决了HTTP的哪些问题？

* 窃听风险
* 篡改风险
* 冒充风险

采用以下手段：

* 信息加密：混合加密的方式
* 校验机制：用摘要算法实现完整性
* 身份证书：将服务器公钥放到数字证书中

1.混合加密

对称加密和非对称加密相结合

通信建立前使用非对称加密，建立后使用对称加密

2.摘要算法+数字签名

内容+哈希值，如果全部被替换就没有办法

公钥加密，私钥解密：保证内容传输的安全

私钥加密，公钥解密：保证信息不会被冒充，保证信息来源。

在这儿可以用私钥对哈希值进行加密

3.数字证书

个人信息+公钥+数字签名

### HTTPS 是如何建立连接的？其间交互了什么？

*1. ClientHello*

首先，由客户端向服务器发起加密通信请求，也就是 `ClientHello` 请求。

在这一步，客户端主要向服务器发送以下信息：

（1）客户端支持的 TLS 协议版本，如 TLS 1.2 版本。

（2）客户端生产的随机数（`Client Random`），后面用于生成「会话秘钥」条件之一。

（3）客户端支持的密码套件列表，如 RSA 加密算法。

*2. SeverHello*

服务器收到客户端请求后，向客户端发出响应，也就是 `SeverHello`。服务器回应的内容有如下内容：

（1）确认 TLS 协议版本，如果浏览器不支持，则关闭加密通信。

（2）服务器生产的随机数（`Server Random`），也是后面用于生产「会话秘钥」条件之一。

（3）确认的密码套件列表，如 RSA 加密算法。

（4）服务器的数字证书。

*3.客户端回应*

客户端收到服务器的回应之后，首先通过浏览器或者操作系统中的 CA 公钥，确认服务器的数字证书的真实性。

如果证书没有问题，客户端会**从数字证书中取出服务器的公钥**，然后使用它加密报文，向服务器发送如下信息：

（1）一个随机数（`pre-master key`）。该随机数会被服务器公钥加密。

（2）加密通信算法改变通知，表示随后的信息都将用「会话秘钥」加密通信。

（3）客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时把之前所有内容的发生的数据做个摘要，用来供服务端校验。

上面第一项的随机数是整个握手阶段的第三个随机数，会发给服务端，所以这个随机数客户端和服务端都是一样的。

**服务器和客户端有了这三个随机数（Client Random、Server Random、pre-master key），接着就用双方协商的加密算法，各自生成本次通信的「会话秘钥」**。

*4. 服务器的最后回应*

服务器收到客户端的第三个随机数（`pre-master key`）之后，通过协商的加密算法，计算出本次通信的「会话秘钥」。

然后，向客户端发送最后的信息：

（1）加密通信算法改变通知，表示随后的信息都将用「会话秘钥」加密通信。

（2）服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时把之前所有内容的发生的数据做个摘要，用来供客户端校验。































