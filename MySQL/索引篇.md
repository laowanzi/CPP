### 索引

![索引提纲](C:\Users\Zhang Wan\Desktop\学习笔记\MySQL\Pictures\索引提纲.webp)

#### 索引的分类

* 数据结构：B+tree索引、Hash索引、Full-text索引
* 物理存储：聚簇索引（主键索引）、二级索引（辅助索引）
* 字段特性：主键索引、唯一索引、普通索引、前缀索引
* 字段个数：单列索引、联合索引

在创建表时，`InnoDB` 存储引擎会根据不同的场景选择不同的列作为索引：

* 如果有主键，默认使用主键作为聚簇索引的索引键（Key）；

* 如何没有主键，选择第一个不包含NULL值的唯一列作为聚簇索引的索引键（Key）；
* 以上两个都没有，`InnoDB` 自动生成一个隐式自增id作为聚簇索引的索引键（Key）；

其他索引都属于辅助索引（Secondary Index），也被称为二级索引或非聚簇索引。

创建的主键索引和二级索引默认使用B+tree索引

![btree.drawio](C:\Users\Zhang Wan\Desktop\学习笔记\MySQL\Pictures\btree.drawio.webp)

聚簇索引中Key是主键，叶子节点中的值是表的一行数据

![二级索引btree.drawio](C:\Users\Zhang Wan\Desktop\学习笔记\MySQL\Pictures\二级索引btree.drawio.webp)

二级索引中Key由用户指定，叶子节点中的值是主键

回表：先在二级索引中找到主键值，再拿着主键值到聚簇索引中查询，需要查两个B+tree才能查到数据。

覆盖索引：在二级索引的B+tree就能查询到结果的过程就叫做覆盖索引，只需要查一个B+tree就能查到数据。

#### 按字段特性分类

主键索引：建立在主键字段上的索引，一张表最多只能有一个

唯一索引：建立在UNIQUE字段上的索引，一张表可以有多个，索引列的值必须唯一，但允许有空值

普通索引：建立在普通字段上的索引

前缀索引：对字符类型字段的前几个字符建立的索引，可以建立在字段类型为char、varchar、binary、varbinary的列上

#### 按字段个数分类

单列索引：建立在单列上的索引，比如主键索引

联合索引：建立在多列上的索引

```mysql
CREATE INDEX index_product_no_name ON product(product_no, name);
```

![联合索引.drawio](C:\Users\Zhang Wan\Desktop\学习笔记\MySQL\Pictures\联合索引.drawio.webp)

联合索引查询的B+Tree是先按product_no 进行排序，在product_no 相同的情况再按 name 字段排序

使用联合索引的时候，存在最左匹配原则