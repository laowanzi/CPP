## 什么是缓存雪崩、击穿、穿透

![61781cd6d82e4a0cc5f7521333049f0d](C:\Users\Zhang Wan\Desktop\学习笔记\Redis\Pictures\61781cd6d82e4a0cc5f7521333049f0d.webp)

### 缓存雪崩

为了保证缓存中的数据与数据库中的数据一致性，会给 Redis 里的数据设置过期时间，当缓存数据过期时，用户访问的数据不在缓存，业务系统就会访问数据库，并将数据更新到 Redis 里。

![e2b8d2eb5536aa71664772457792ec40-20230309232851699](C:\Users\Zhang Wan\Desktop\学习笔记\Redis\Pictures\e2b8d2eb5536aa71664772457792ec40-20230309232851699.webp)

当**大量缓存数据在同一时间过期（失效）或者 Redis 故障宕机**时，这时如果有大量的用户请求，就会全部访问数据库，严重的会导致数据库宕机，这就是**缓存雪崩**的问题。

#### 大量数据同时过期

针对大量数据同时过期引起的缓存雪崩问题，常见的应对方法有以下这几种：

- 均匀设置过期时间
- 互斥锁
- 双 key 策略
- 后台更新缓存

1. 均匀设置过期时间

避免设置相同的过期时间，给定一个基准值，在基准值上加上一个随机数

2.互斥锁

如果发现访问的数据不在 Redis 里，就加个互斥锁，保证同一时间内只有一个请求来构建缓存，最好设置超时时间

3.

#### Redis 故障宕机

针对 Redis 故障宕机而引发的缓存雪崩问题，常见的应对方法有下面这几种：

- 服务熔断或请求限流机制；

- 构建 Redis 缓存高可靠集群；

1. *服务熔断或请求限流机制*

因为 Redis 故障宕机而导致缓存雪崩问题时，我们可以启动**服务熔断**机制，**暂停业务应用对缓存服务的访问，直接返回错误**，不用再继续访问数据库，从而降低对数据库的访问压力，保证数据库系统的正常运行，然后等到 Redis 恢复正常后，再允许业务应用访问缓存服务。

服务熔断机制是保护数据库的正常允许，但是暂停了业务应用访问缓存服系统，全部业务都无法正常工作

为了减少对业务的影响，我们可以启用**请求限流**机制，**只将少部分请求发送到数据库进行处理，再多的请求就在入口直接拒绝服务**，等到 Redis 恢复正常并把缓存预热完后，再解除请求限流的机制。

*2. 构建 Redis 缓存高可靠集群*

服务熔断或请求限流机制是缓存雪崩发生后的应对方案，我们最好通过**主从节点的方式构建 Redis 缓存高可靠集群**。

如果 Redis 缓存的主节点故障宕机，从节点可以切换成为主节点，继续提供缓存服务，避免了由于 Redis 故障宕机而导致的缓存雪崩问题